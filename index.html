<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <!-- ãƒšãƒ¼ã‚¸ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’UTF-8ã«è¨­å®š -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã«å¯¾å¿œã™ã‚‹ãŸã‚ã®ãƒ¡ã‚¿ã‚¿ã‚° -->
    <title>æ˜ ç”»ã‚¢ãƒ—ãƒª</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- jQueryãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã‚€ -->
</head>

<body>
    <h1>ğŸ¿æ˜ ç”»ğŸ¿</h1>
    <div class="buttons">
        <button id="nowPlayingBtn">ä¸Šæ˜ ä¸­</button>
        <button id="upcomingBtn">å…¬é–‹äºˆå®š</button>
        <button id="popularBtn">äººæ°—é †</button>
        <button id="favoritesBtn">ãŠæ°—ã«å…¥ã‚Š</button>
    </div>
    
    <div id="movies" class="movies-container"></div>
    <div id="favorites" class="movies-container" style="display:none;"></div>
    
<script>
// TMDbã® APIã‚­ãƒ¼ã‚’å–å¾—ã—ã¦ã€æ—¥æœ¬ã®æ˜ ç”»ãƒ‡ãƒ¼ã‚¿ã‚’ã¨ã‚‹
const apiKey = 'd38f6eff19e55de29df9481c4e730476'; 
const region = 'JP'; 

// å„ã‚«ãƒ†ã‚´ãƒªã®æ˜ ç”»ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®URL
const nowPlayingUrl = `https://api.themoviedb.org/3/movie/now_playing?api_key=${apiKey}&language=ja-JP&page=1&region=${region}`;
const upcomingUrl = `https://api.themoviedb.org/3/movie/upcoming?api_key=${apiKey}&language=ja-JP&page=1&region=${region}`;
const popularUrl = `https://api.themoviedb.org/3/movie/popular?api_key=${apiKey}&language=ja-JP&page=1&region=${region}`;

// jQuery ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
const moviesContainer = $('#movies');
const favoritesContainer = $('#favorites');

// æ˜ ç”»æƒ…å ±ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹é–¢æ•°
function fetchMovies(url) {
  $.ajax({
    url: url, // æ˜ ç”»ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹URL
    method: 'GET', // HTTPãƒ¡ã‚½ãƒƒãƒ‰ã‚’GETã«ã™ã‚‹
    success: function(data) {
      displayMovies(data.results); // å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ˜ ç”»ã‚’è¡¨ç¤º
    },
    error: function(xhr, status, error) {
      console.error('Error fetching movies:', error); // ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®ãƒ­ã‚°
    }
  });
}

// æ˜ ç”»ã®æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
function displayMovies(movies) {
  moviesContainer.empty(); // å‰ã®æ˜ ç”»æƒ…å ±ã‚’å‰Šé™¤
  moviesContainer.show(); // æ˜ ç”»ã‚³ãƒ³ãƒ†ãƒŠã‚’è¡¨ç¤º
  favoritesContainer.hide();

  $.each(movies, function(index, movie) {
    const movieDiv = $('<div>').addClass('movie'); 
    const poster = $('<img>').attr('src', `https://image.tmdb.org/t/p/w500${movie.poster_path}`).attr('alt', movie.title); // ãƒã‚¹ã‚¿ãƒ¼ç”»åƒ
    const detailsDiv = $('<div>').addClass('movie-details'); // è©³ç´°æƒ…å ±ç”¨ã«ãƒœãƒƒã‚¯ã‚¹ä½œã‚‹
    const title = $('<h2>').text(movie.title); // æ˜ ç”»ã®ã‚¿ã‚¤ãƒˆãƒ«
    const releaseDate = $('<p>').text('å…¬é–‹æ—¥: ' + movie.release_date); // å…¬é–‹æ—¥
    const overview = $('<p>').text(movie.overview); // æ¦‚è¦
    const favoriteBtn = $('<button>').text('add').addClass('favorite-btn').data('movie', movie); // ãŠæ°—ã«å…¥ã‚Šè¿½åŠ 

    detailsDiv.append(title, releaseDate, overview, favoriteBtn); // è©³ç´°æƒ…å ±ã‚’è¿½åŠ 
    movieDiv.append(poster, detailsDiv); // ãƒã‚¹ã‚¿ãƒ¼ã¨è©³ç´°æƒ…å ±ã‚’ã¾ã¨ã‚ã‚‹
    moviesContainer.append(movieDiv); // æ˜ ç”»ã‚³ãƒ³ãƒ†ãƒŠã«è¿½åŠ 
  });
}

// ãŠæ°—ã«å…¥ã‚Šã®æ˜ ç”»ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°ã€APIã§è‡ªå‹•å–å¾—ã§ããªã„ã®ã§ã“ã“ã ã‘ç”¨æ„ã™ã‚‹å¿…è¦ã‚ã‚Š
function displayFavorites() {
  moviesContainer.hide(); 
  favoritesContainer.show(); 
  favoritesContainer.empty(); 

  const favorites = JSON.parse(localStorage.getItem('favorites')) || []; // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãŠæ°—ã«å…¥ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

  if (favorites.length === 0) {
    favoritesContainer.html('<p>ãŠæ°—ã«å…¥ã‚Šã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>'); // ãŠæ°—ã«å…¥ã‚ŠãŒç„¡ã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    return;
  }

  favorites.forEach(movie => { //ã²ã¨ã¤ä¸Šã¨åŒã˜
    const movieDiv = $('<div>').addClass('movie');
    const poster = $('<img>').attr('src', `https://image.tmdb.org/t/p/w500${movie.poster_path}`).attr('alt', movie.title);
    const detailsDiv = $('<div>').addClass('movie-details');
    const title = $('<h2>').text(movie.title);
    const releaseDate = $('<p>').text('Release Date: ' + movie.release_date);
    const overview = $('<p>').text(movie.overview);
    const deleteBtn = $('<button>').text('Remove from Favorites').addClass('delete-btn').data('id', movie.id); // ãŠæ°—ã«å…¥ã‚Šå‰Šé™¤ãƒœã‚¿ãƒ³

    detailsDiv.append(title, releaseDate, overview, deleteBtn);
    movieDiv.append(poster, detailsDiv);
    favoritesContainer.append(movieDiv);
  });
}

// ãŠæ°—ã«å…¥ã‚Šè¿½åŠ ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
$(document).on('click', '.favorite-btn', function() {
  const movie = $(this).data('movie'); 
  let favorites = JSON.parse(localStorage.getItem('favorites')) || []; // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãŠæ°—ã«å…¥ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

  if (!favorites.some(fav => fav.id === movie.id)) { // ã¾ã ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ã•ã‚Œã¦ã„ãªã„å ´åˆ
    favorites.push(movie); 
    localStorage.setItem('favorites', JSON.stringify(favorites)); // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    console.log('Added to favorites:', movie.title); // ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ­ã‚°
  }
});

// ãŠæ°—ã«å…¥ã‚Šå‰Šé™¤ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
$(document).on('click', '.delete-btn', function() {
  const movieId = $(this).data('id'); // ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ˜ ç”»ã®IDã‚’å–å¾—
  let favorites = JSON.parse(localStorage.getItem('favorites')) || []; // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãŠæ°—ã«å…¥ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

  favorites = favorites.filter(movie => movie.id !== movieId); // å‰Šé™¤å¯¾è±¡ã®æ˜ ç”»ä»¥å¤–ã‚’æ®‹ã™
  localStorage.setItem('favorites', JSON.stringify(favorites)); // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
  displayFavorites(); // ãŠæ°—ã«å…¥ã‚Šä¸€è¦§ã‚’æ›´æ–°
});

// ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³
$('#favoritesBtn').on('click', function() {
  displayFavorites(); // ãŠæ°—ã«å…¥ã‚Šä¸€è¦§ã‚’è¡¨ç¤º
});

// å„ã‚«ãƒ†ã‚´ãƒªãƒœã‚¿ãƒ³
$('#nowPlayingBtn').on('click', function() {
  fetchMovies(nowPlayingUrl);
});

$('#upcomingBtn').on('click', function() {
  fetchMovies(upcomingUrl); 
});


$('#popularBtn').on('click', function() {
  fetchMovies(popularUrl);
});

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¸Šæ˜ ä¸­ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º
$(document).ready(function() {
  fetchMovies(nowPlayingUrl);
});

</script>
</body>
</html>